
<%- include('./include/dashboardhead.ejs') -%>

  
<!-- / Navbar -->

      

      <!-- Content wrapper -->
      <div class="content-wrapper">

        <!-- Content -->
        
          <div class="container-xxl flex-grow-1 container-p-y">
            
            

<h4 class="py-3 mb-4">
  <span class="text-muted fw-light">Property Management /</span> Property Listing
</h4>

<!-- Property Listing Wizard -->
<div id="wizard-property-listing" class="bs-stepper vertical mt-2">
  <div class="bs-stepper-header">
    <div class="step" data-target="#personal-details">
      <button type="button" class="step-trigger">
        <span class="bs-stepper-circle">
          <i class='bx bx-user'></i>
        </span>
        <span class="bs-stepper-label">
          <span class="bs-stepper-title">Personal Details</span>
          <span class="bs-stepper-subtitle">Your Name/Email</span>
        </span>
      </button>
    </div>
    <div class="line"></div>
    <div class="step" data-target="#property-details">
      <button type="button" class="step-trigger">
        <span class="bs-stepper-circle">
          <i class='bx bx-home'></i>
        </span>
        <span class="bs-stepper-label">
          <span class="bs-stepper-title">Property Details</span>
          <span class="bs-stepper-subtitle">Property Type</span>
        </span>
      </button>
    </div>
    <div class="line"></div>
    <div class="step" data-target="#property-features">
      <button type="button" class="step-trigger">
        <span class="bs-stepper-circle">
          <i class='bx bx-star'></i>
        </span>
        <span class="bs-stepper-label">
          <span class="bs-stepper-title">Property Features</span>
          <span class="bs-stepper-subtitle">Bedrooms/Floors</span>
        </span>
      </button>
    </div>
    <div class="line"></div>
    <div class="step" data-target="#property-area">
      <button type="button" class="step-trigger">
        <span class="bs-stepper-circle">
          <i class='bx bx-map'></i>
        </span>
        <span class="bs-stepper-label">
          <span class="bs-stepper-title">Property Area</span>
          <span class="bs-stepper-subtitle">Covered Area</span>
        </span>
      </button>
    </div>
    <div class="line"></div>
    <div class="step" data-target="#property-view">
      <button type="button" class="step-trigger">
        <span class="bs-stepper-circle">
          <i class='bx bx-landscape'></i>
        </span>
        <span class="bs-stepper-label">
          <span class="bs-stepper-title">Property View</span>
          <span class="bs-stepper-subtitle">Image & Videos</span>
        </span>
      </button>
    </div>
    <div class="line"></div>
    <div class="step" data-target="#price-details">
      <button type="button" class="step-trigger">
        <span class="bs-stepper-circle">
          <i class='bx bx-dollar'></i>
        </span>
        <span class="bs-stepper-label">
          <span class="bs-stepper-title">Price Details</span>
          <span class="bs-stepper-subtitle">Expected Price</span>
        </span>
      </button>
    </div>
  </div>
  <div class="bs-stepper-content">
    <form id="wizard-property-listing-form" onSubmit="return false">

      <!-- Personal Details -->
      <div id="personal-details" class="content">
        <div class="row g-3">
         
          <div class="col-sm-6">
            <label class="form-label" for="plName">Property Name</label>
            <input type="text" id="plName" name="plName" class="form-control" value="<%= property.plName %>" />
          </div>
          <div class="col-sm-6">
            <label class="form-label" for="plShort">Short Description</label>
            <input type="text" id="plShort" name="plShort" class="form-control" value="<%= property.plShort %>" />
          </div>
         
          <div class="col-sm-6">
            <label class="form-label" for="plEmail">Agent Email</label>
            <input type="text" id="plEmail" name="plEmail" class="form-control" value="<%= property.plEmail %>"  />
          </div>
          <div class="col-sm-6">
            <label class="form-label" for="plContact">Agent Contact</label>
            <div class="input-group input-group-merge">
              <input type="text" id="plContact" name="plContact" class="form-control contact-number-mask" value="<%= property.plContact %>"  />
            </div>
          </div>
          <div class="col-12 d-flex justify-content-between">
            <button class="btn btn-label-secondary btn-prev" disabled> <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i>
              <span class="align-middle d-sm-inline-block d-none">Previous</span>
            </button>
            <button class="btn btn-primary btn-next"> <span class="align-middle d-sm-inline-block d-none me-sm-1">Next</span> <i class="bx bx-chevron-right bx-sm me-sm-n2"></i></button>
          </div>
        </div>
      </div>

      <!-- Property Details -->
      <div id="property-details" class="content">
        <div class="row g-3">
         
        
      
         
          <div class="col-sm-6">
            <label class="form-label" for="plState">Area</label>
            <input type="text" id="plState" name="plState" class="form-control" value="<%= property.plState %>" />
          </div>
        
          <div class="col-sm-6">
            <label class="form-label" for="plLandmark">Landmark</label>
            <input type="text" id="plLandmark" name="plLandmark" class="form-control" value="<%= property.plLandmark %>" />
          </div>
          <div class="col-lg-12">
            <label class="form-label" for="plAddress">Address</label>
            <textarea id="plAddress" name="plAddress" class="form-control" rows="2" ><%= property.plAddress %></textarea>
          </div>
          <div class="col-lg-12">
            <label class="form-label" for="Description">Description</label>
            <textarea id="plDescription" name="plDescription" class="form-control" rows="2" placeholder="Anything about the proerty">
              <%= property.plDescription %>
            </textarea>
          </div>
          <div class="col-12 d-flex justify-content-between">
            <button class="btn btn-primary btn-prev"> <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i> <span class="align-middle d-sm-inline-block d-none">Previous</span> </button>
            <button class="btn btn-primary btn-next"> <span class="align-middle d-sm-inline-block d-none me-sm-1">Next</span> <i class="bx bx-chevron-right bx-sm me-sm-n2"></i></button>
          </div>
        </div>
      </div>

      <!-- Property Features -->
      <div id="property-features" class="content">
        <div class="row g-3">
          <div class="col-sm-6">
            <label class="form-label d-block" for="plBedrooms">Bedrooms</label>
            <input type="number" id="plBedrooms" name="plBedrooms" class="form-control" value="<%= property.plBedrooms %>" />
          </div>
          <div class="col-sm-6">
            <label class="form-label" for="plFloorNo">Floors</label>
            <input type="number" id="plFloorNo" name="plFloorNo" class="form-control" value="<%= property.plFloorNo %>" />
          </div>
          <div class="col-sm-6">
            <label class="form-label d-block" for="plBathrooms">Bathrooms</label>
            <input type="number" id="plBathrooms" name="plBathrooms" class="form-control" value="<%= property.plBathrooms %>" />
          </div>
          <div class="col-sm-6">
            <label class="form-label" for="plFurnishedStatus">Furnished Status</label>
            <select id="plFurnishedStatus" name="plFurnishedStatus" class="form-select">
              <option disabled value="">Select furnished status</option>
              <option value="Fully furnished" <%= property.plFurnishedStatus === 'Fully furnished' ? 'selected' : '' %> >Fully furnished</option>
              <option value="Furnished" <%= property.plFurnishedStatus === 'Furnished' ? 'selected' : '' %>>Furnished</option>
              <option value="Semi furnished" <%= property.plFurnishedStatus === 'Semi furnished' ? 'selected' : '' %>>Semi furnished</option>
              <option value="Unfurnished" <%= property.plFurnishedStatus === 'Unfurnished' ? 'selected' : '' %>>Unfurnished</option>
            </select>
          </div>
          
          <div class="col-lg-12">
            <label class="form-label" for="plFurnishingDetails">Features</label>
            <input id="plFurnishingDetails" name="plFurnishingDetails" class="form-control" placeholder="select options" value="<%= property.plFurnishingDetails %>">
          </div>
          <div class="col-sm-6">
            <label class="form-label">Is there any common area?</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="plCommonAreaRadio" id="plCommonAreaRadioYes" value="Yes" <%= property.plCommonAreaRadio === 'Yes' ? 'checked' : '' %>>
              <label class="form-check-label" for="plCommonAreaRadioYes">Yes</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="plCommonAreaRadio" id="plCommonAreaRadioNo" value="No" <%= property.plCommonAreaRadio === 'No' ? 'checked' : '' %>>
              <label class="form-check-label" for="plCommonAreaRadioNo">No</label>
            </div>
          </div>
          
          <div class="col-sm-6">
            <label class="form-label">Is there any attached balcony?</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="plAttachedBalconyRadio" id="plAttachedBalconyRadioYes" value="Yes" <%= property.plAttachedBalconyRadio === 'Yes' ? 'checked' : '' %>>
              <label class="form-check-label" for="plAttachedBalconyRadioYes">Yes</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="plAttachedBalconyRadio" id="plAttachedBalconyRadioNo" value="No" <%= property.plAttachedBalconyRadio === 'No' ? 'checked' : '' %>>
              <label class="form-check-label" for="plAttachedBalconyRadioNo">No</label>
            </div>
          </div>
          
          <div class="col-12 d-flex justify-content-between">
            <button class="btn btn-primary btn-prev"> <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i> <span class="align-middle d-sm-inline-block d-none">Previous</span> </button>
            <button class="btn btn-primary btn-next"> <span class="align-middle d-sm-inline-block d-none me-sm-1">Next</span> <i class="bx bx-chevron-right bx-sm me-sm-n2"></i></button>
          </div>
        </div>
      </div>

      <!-- Property Area -->
      <div id="property-area" class="content">
        <div class="row g-3">
          <div class="col-sm-6">
            <label class="form-label d-block" for="plTotalArea">Total Area</label>
            <div class="input-group input-group-merge">
              <input type="number" class="form-control" id="plTotalArea" name="plTotalArea" value="<%= property.plTotalArea %>"  aria-describedby="pl-total-area">
              <span class="input-group-text" id="pl-total-area">sq-ft</span>
            </div>
          </div>
          <div class="col-sm-6">
            <label class="form-label d-block" for="plCarpetArea">Carpet Area</label>
            <div class="input-group input-group-merge">
              <input type="number" class="form-control" id="plCarpetArea" name="plCarpetArea" value="<%= property.plCarpetArea %>" aria-describedby="pl-carpet-area">
              <span class="input-group-text" id="pl-carpet-area">sq-ft</span>
            </div>
          </div>
          <div class="col-sm-6">
            <label class="form-label d-block" for="plPlotArea">Plot Area</label>
            <div class="input-group input-group-merge">
              <input type="number" class="form-control" id="plPlotArea" name="plPlotArea" value="<%= property.plPlotArea %>" aria-describedby="pl-plot-area">
              <span class="input-group-text" id="pl-plot-area">sq-yd</span>
            </div>
          </div>
          <div class="col-sm-6">
            <label class="form-label d-block" for="plAvailableFrom">Available From</label>
            <input type="text" id="plAvailableFrom" name="plAvailableFrom" class="form-control flatpickr" placeholder="YYYY-MM-DD" value="<%= property.plAvailableFrom %>" />
          </div>          
          <div class="col-sm-6">
            <label class="form-label">Central Cooling</label>
            <div class="form-check">
              <input class="form-check-input" value="Available" type="radio" name="plCentralcooling" id="plCoolingAvailable" <% if (property.plCentralcooling === 'Available') { %> checked <% } %>>
              <label class="form-check-label" for="plCoolingAvailable">Available</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" value="Not Available" type="radio" name="plCentralcooling" id="plCoolingNOt" <% if (property.plCentralcooling === 'Not Available') { %> checked <% } %>>
              <label class="form-check-label" for="plCoolingNOt">Not Available</label>
            </div>
          </div>
          
          <div class="col-sm-6">
            <label class="form-label">Swimming Pool</label>
            <div class="form-check">
              <input class="form-check-input" value="Available" type="radio" name="plSwimmingPool" id="plSwimmingpoolavailable" <% if (property.plSwimmingPool === 'Available') { %> checked <% } %>>
              <label class="form-check-label" for="plSwimmingpoolavailable">Available</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" value="Not Available" type="radio" name="plSwimmingPool" id="plSwimmingpoolnot" <% if (property.plSwimmingPool === 'Not Available') { %> checked <% } %>>
              <label class="form-check-label" for="plSwimmingpoolnot">Not Available</label>
            </div>
          </div>
          
          <div class="col-sm-6">
            <label class="form-label">Is Property Facing Main Road?</label>
            <div class="form-check">
              <input class="form-check-input" value="Yes" type="radio" name="plRoadFacingRadio" id="plRoadFacingRadioYes" <% if (property.plRoadFacingRadio === 'Yes') { %> checked <% } %>>
              <label class="form-check-label" for="plRoadFacingRadioYes">Yes</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" value="No" type="radio" name="plRoadFacingRadio" id="plRoadFacingRadioNo" <% if (property.plRoadFacingRadio === 'No') { %> checked <% } %>>
              <label class="form-check-label" for="plRoadFacingRadioNo">No</label>
            </div>
          </div>
          
          <div class="col-sm-6">
            <label class="form-label">Gated Colony?</label>
            <div class="form-check">
              <input class="form-check-input" value="Yes" type="radio" name="plGatedColonyRadio" id="plGatedColonyRadioYes" <% if (property.plGatedColonyRadio === 'Yes') { %> checked <% } %>>
              <label class="form-check-label" for="plGatedColonyRadioYes">Yes</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" value="No" type="radio" name="plGatedColonyRadio" id="plGatedColonyRadioNo" <% if (property.plGatedColonyRadio === 'No') { %> checked <% } %>>
              <label class="form-check-label" for="plGatedColonyRadioNo">No</label>
            </div>
          </div>
          
          <div class="col-12 d-flex justify-content-between">
            <button class="btn btn-primary btn-prev"> <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i> <span class="align-middle d-sm-inline-block d-none">Previous</span> </button>
            <button class="btn btn-primary btn-next"> <span class="align-middle d-sm-inline-block d-none me-sm-1">Next</span> <i class="bx bx-chevron-right bx-sm me-sm-n2"></i></button>
          </div>
        </div>
      </div>
      <div id="property-view" class="content">
        <div class="row g-3"> 
          <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0 card-title">Media</h5>
            </div>
            <div class="card-body">
              <div class="dropzone needsclick">
                <div class="dz-message needsclick my-5" id="dropzone-basic">
                  <p class="fs-4 note needsclick my-2">Drag and drop your image or video here</p>
                  <small class="text-muted d-block fs-6 my-2">or</small>
                  <span class="note needsclick btn bg-label-primary d-inline" id="btnBrowse">Browse image or video</span>
                </div>
                <input name="file" hidden multiple type="file" id="fileInput" accept="image/*, video/*" />
                <div class="preview-container" id="previewContainer"></div>
                <div id="uploadProgress" class="upload-progress"></div>

              </div>
            </div>
          </div>
          <div class="col-12 d-flex justify-content-between">
            <button class="btn btn-primary btn-prev"> <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i> <span class="align-middle d-sm-inline-block d-none">Previous</span> </button>
            <button class="btn btn-primary btn-next"> <span class="align-middle d-sm-inline-block d-none me-sm-1">Next</span> <i class="bx bx-chevron-right bx-sm me-sm-n2"></i></button>
          </div>
        </div>
      </div>

      <!-- Price Details -->
      <div id="price-details" class="content">
        <div class="row g-3">
          <div class="col-sm-6">
            <label class="form-label d-block" for="plExpeactedPrice">Expected Price</label>
            <div class="input-group input-group-merge">
              <input type="number" class="form-control" id="plExpeactedPrice" name="plExpeactedPrice" placeholder="25,000" aria-describedby="pl-expeacted-price" value="<%= property.plExpeactedPrice %>">
              <span class="input-group-text" id="pl-expeacted-price">$</span>
            </div>
          </div>
          <div class="col-sm-6">
            <label class="form-label d-block" for="plPriceSqft">Price per Sqft</label>
            <div class="input-group input-group-merge">
              <input type="number" class="form-control" id="plPriceSqft" name="plPriceSqft" placeholder="500" aria-describedby="pl-price-sqft" value="<%= property.plPriceSqft %>">
              <span class="input-group-text" id="pl-price-sqft">$</span>
            </div>
          </div>
          <div class="col-sm-6">
            <label class="form-label d-block" for="plMaintenenceCharge">Maintenance Charge</label>
            <div class="input-group input-group-merge">
              <input type="number" class="form-control" id="plMaintenenceCharge" name="plMaintenenceCharge" placeholder="50" aria-describedby="pl-mentenence-charge" value="<%= property.plMaintenenceCharge %>">
              <span class="input-group-text" id="pl-mentenence-charge">$</span>
            </div>
          </div>
          <div class="col-sm-6">
            <label class="form-label" for="plMaintenencePer">Maintenance</label>
            <select id="plMaintenencePer" name="plMaintenencePer" class="form-select">
              <option value="Monthly" <%= property.plMaintenencePer === 'Monthly' ? 'selected' : '' %>>Monthly</option>
              <option value="Quarterly" <%= property.plMaintenencePer === 'Quarterly' ? 'selected' : '' %>>Quarterly</option>
              <option value="Yearly" <%= property.plMaintenencePer === 'Yearly' ? 'selected' : '' %>>Yearly</option>
              <option value="One-time" <%= property.plMaintenencePer === 'One-time' ? 'selected' : '' %>>One-time</option>
            
            </select>
          </div>
          <div class="col-sm-6">
            <label class="form-label d-block" for="plBookingAmount">Booking/Token Amount</label>
            <div class="input-group input-group-merge">
              <input type="number" class="form-control" id="plBookingAmount" name="plBookingAmount" placeholder="250" aria-describedby="pl-booking-amount" value="<%= property.plBookingAmount %>">
              <span class="input-group-text" id="pl-booking-amount">$</span>
            </div>
          </div>
          
          
          <div class="col-sm-6">
            <label class="form-label">Laundry Room</label>
            <div class="form-check">
              <input class="form-check-input" value="Available" type="radio" name="plLaundryRoomRadio" id="plLaundryRoomAvailable" <% if (property.plLaundryRoomRadio === 'Available') { %>checked<% } %>>
              <label class="form-check-label" for="plLaundryRoomAvailable">Laundry Available</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" value="Not Available" type="radio" name="plLaundryRoomRadio" id="plLaundryRoomNotAvailable" <% if (property.plLaundryRoomRadio === 'Not Available') { %>checked<% } %>>
              <label class="form-check-label" for="plLaundryRoomNotAvailable">Laundry Not Available</label>
            </div>
          </div>
          
          <div class="col-sm-6">
            <label class="form-label">Fire Place / Central Heating</label>
            <div class="form-check">
              <input class="form-check-input" value="Available" type="radio" name="plFireplaceCentralHeatingRadio" id="plFireplaceCentralHeatingAvailable" <% if (property.plFireplaceCentralHeatingRadio === 'Available') { %>checked<% } %>>
              <label class="form-check-label" for="plFireplaceCentralHeatingAvailable">Available</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" value="Not Available" name="plFireplaceCentralHeatingRadio" id="plFireplaceCentralHeatingNotAvailable" <% if (property.plFireplaceCentralHeatingRadio === 'Not Available') { %>checked<% } %>>
              <label class="form-check-label" for="plFireplaceCentralHeatingNotAvailable">Not Available</label>
            </div>
          </div>
          
          <div class="col-sm-6">
            <label class="form-label">Lawn</label>
            <div class="form-check">
              <input class="form-check-input" value="Available" type="radio" name="plLawnRadio" id="plLawnAvailable" <% if (property.plLawnRadio === 'Available') { %>checked<% } %>>
              <label class="form-check-label" for="plLawnAvailable">Available</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" value="Not Available" type="radio" name="plLawnRadio" id="plLawnNotAvailable" <% if (property.plLawnRadio === 'Not Available') { %>checked<% } %>>
              <label class="form-check-label" for="plLawnNotAvailable">Not Available</label>
            </div>
          </div>
          
      
          
          
         
          <div class="col-12 d-flex justify-content-between">
            <button class="btn btn-primary btn-prev"> <i class="bx bx-chevron-left bx-sm ms-sm-n2"></i> <span class="align-middle d-sm-inline-block d-none">Previous</span> </button>
            <button class="btn btn-success btn-submit btn-next">Submit</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
<!--/ Property Listing Wizard -->


<script>
  let fileurl = []
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("wizard-property-listing-form");
    const submitButton = form.querySelector(".btn-submit");
    fileurl = <%- JSON.stringify(property.file) %>;

    fileurl.forEach((file) => {
      createPreviewItem(file)
    })

  
    submitButton.addEventListener("click", function () {
      // Collect form data
      const formData = new FormData(form);
      const formDataObj = {};
      formData.forEach((value, key) => {
        if (key !== "file") {
          formDataObj[key] = value;
        }else{
          formDataObj[key] = fileurl;

        }
      });
      formDataObj.id = "<%= property._id %>";


      // Make the API call
      const apiEndpoint = "https://www.safehomes.ae/backend/posteditproperty"; // Replace with your API endpoint
      fetch(apiEndpoint, {
        method: "POST", // Replace with the appropriate HTTP method (e.g., POST, PUT, etc.)
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(formDataObj),
      })
        .then((response) => response.json())
        .then((data) => {
          // Handle the API response if needed
          location.reload();
          // Show a success message, redirect, or perform other actions here
        })
        .catch((error) => {
          // Handle errors here
          console.error("Error:", error);
          // Show an error message or take appropriate action
        });
    });
  });
</script>


            
          </div>
          <!-- / Content -->

          
          

<!-- Footer -->

<!-- / Footer -->

          
          <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->
      </div>
      <!-- / Layout page -->
    </div>

    
    
    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
    
    
    <!-- Drag Target Area To SlideIn Menu On Small Screens -->
    <div class="drag-target"></div>
    
  </div>
  <!-- / Layout wrapper -->

  


  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="../assets/vendor/libs/jquery/jquery.js"></script>
  <script src="../assets/vendor/libs/popper/popper.js"></script>
  <script src="../assets/vendor/js/bootstrap.js"></script>
  <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="../assets/vendor/libs/hammer/hammer.js"></script>
  <script src="../assets/vendor/libs/i18n/i18n.js"></script>
  <script src="../assets/vendor/libs/typeahead-js/typeahead.js"></script>
  <script src="../assets/vendor/js/menu.js"></script>
  
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="../assets/vendor/libs/quill/katex.js"></script>
  <script src="../assets/vendor/libs/quill/quill.js"></script>
  
  <script src="../assets/vendor/libs/cleavejs/cleave.js"></script>
<script src="../assets/vendor/libs/cleavejs/cleave-phone.js"></script>
<script src="../assets/vendor/libs/bs-stepper/bs-stepper.js"></script>
<script src="../assets/vendor/libs/select2/select2.js"></script>
<script src="../assets/vendor/libs/dropzone/dropzone.js"></script>
<script src="../assets/vendor/libs/jquery-repeater/jquery-repeater.js"></script>

<script src="../assets/vendor/libs/tagify/tagify.js"></script>
<script src="../assets/vendor/libs/flatpickr/flatpickr.js"></script>
<script src="../assets/js/app-ecommerce-product-add.js"></script>
<script src="../assets/vendor/libs/%40form-validation/umd/bundle/popular.min.js"></script>
<script src="../assets/vendor/libs/%40form-validation/umd/plugin-bootstrap5/index.min.js"></script>
<script src="../assets/vendor/libs/%40form-validation/umd/plugin-auto-focus/index.min.js"></script>

<script>
  const dropzone = document.getElementById('dropzone-basic');
const fileInput = document.getElementById('fileInput');
const previewContainer = document.getElementById('previewContainer');

dropzone.addEventListener('click', () => {
  fileInput.click();
});

dropzone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropzone.classList.add('dragover');
});

dropzone.addEventListener('dragleave', () => {
  dropzone.classList.remove('dragover');
});

dropzone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
  const files = e.dataTransfer.files;
  handleFiles(files);
});

fileInput.addEventListener('change', (e) => {
  const files = e.target.files;
  handleFiles(files);
});

function handleFiles(files) {
  for (const file of files) {
    const formData = new FormData();
    formData.append('files', file);

    const fileType = file.type.split('/')[0];
    if (fileType === 'image' || fileType === 'video') {
      const apiEndpoint = 'https://www.safehomes.ae/backend/uploadeditFiles'; // Replace with your backend API endpoint
    const xhr = new XMLHttpRequest();

    // Event listener to track upload progress
    xhr.upload.addEventListener('progress', (event) => {
      if (event.lengthComputable) {
        const percent = Math.round((event.loaded / event.total) * 100);
        document.getElementById('uploadProgress').innerText = `Uploading: ${percent}%`;
      }
    });
    xhr.onreadystatechange = function () {
      if (xhr.readyState === XMLHttpRequest.DONE) {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          fileurl.push('https://www.safehomes.ae/'+response.filePaths)
          createPreviewItem('https://www.safehomes.ae/'+response.filePaths);

          console.log('Files uploaded successfully!', response.filePaths);
        } else {
          console.error('Error uploading files:', xhr.statusText);
        }
      }
    };

    xhr.open('POST', apiEndpoint);
    xhr.send(formData);
    }
  }
}

function createPreviewItem(file) {
  const previewItem = document.createElement('div');
  previewItem.classList.add('preview-item');
  
  const fileType = getFileTypeFromPath(file);
  if (fileType === 'image') {
    const imagePreview = document.createElement('img');
    imagePreview.src = file;
    previewItem.appendChild(imagePreview);
  } else if (fileType === 'video') {
    const videoPreview = document.createElement('video');
    videoPreview.src = file;
    videoPreview.controls = true;
    previewItem.appendChild(videoPreview);
  }
  
  
  
  const closeButton = document.createElement('button');
  closeButton.innerHTML = '&times;';
  closeButton.type = 'button';
  closeButton.classList.add('btn-close');
  closeButton.addEventListener('click', async () => {
  const confirmMessage = "If you delete the image, it will be removed from the server even without submitting your changes. Are you sure you want to proceed?";
  
  if (window.confirm(confirmMessage)) {
    await deleteFile(file);
    previewItem.remove();
    fileurl = fileurl.filter((fileUrl) => {
      return fileUrl !== file;
    });
  }
});
  previewItem.appendChild(closeButton);

  previewContainer.appendChild(previewItem);
}
function getFileTypeFromPath(filePath) {
  const extension = filePath.split('.').pop().toLowerCase();
  if (['jpg', 'jpeg', 'png', 'gif'].includes(extension)) {
    return 'image';
  } else if (['mp4', 'webm', 'ogg'].includes(extension)) {
    return 'video';
  }
  return '';
}
async function deleteFile(filePath) {
  const fileurl = filePath.split('https://www.safehomes.ae/')[1];

    const apiEndpoint = 'https://www.safehomes.ae/backend/deleteFile'; // Replace with your backend API endpoint
    const xhr = new XMLHttpRequest();
    xhr.open('DELETE', `${apiEndpoint}?filePath=${encodeURIComponent(fileurl)}`);
    xhr.send();
  }


</script>

  <!-- Main JS -->
  <script src="../assets/js/main.js"></script>
<script>  
  var category = <%- JSON.stringify(category) %>;

  // Access the first element in the array

</script>
<script src="../assets/js/wizard-ex-property-listing.js"></script>

</body>


<!-- Mirrored from demos.themeselection.com/sneat-bootstrap-html-admin-template/html/vertical-menu-template/wizard-ex-property-listing.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 21 Jul 2023 18:02:33 GMT -->
</html>

<!-- beautify ignore:end -->

